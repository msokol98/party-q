{"ast":null,"code":"import _objectSpread from\"/home/mitchell/Projects/party-q/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/mitchell/Projects/party-q/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/mitchell/Projects/party-q/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/mitchell/Projects/party-q/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/mitchell/Projects/party-q/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import Mobile from'./mobile';import axios from'axios';import{apiHost}from'config';import useFormatSong from'hooks/useFormatSong';import{Redirect}from'react-router-dom';var PartyContainer=/*#__PURE__*/function(_Component){_inherits(PartyContainer,_Component);var _super=_createSuper(PartyContainer);function PartyContainer(){var _this;_classCallCheck(this,PartyContainer);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={currentSong:JSON.parse(localStorage.getItem('currentSong')),queue:[]};_this.getCurrentSong=function(){var party=_this.props.party;var currentSong=_this.state.currentSong;if(!party||!party.host)return;axios.get(\"https://api.spotify.com/v1/me/player/currently-playing\",{headers:{'Authorization':'Bearer '+party.host.token}}).then(function(response){var song=response.data.item;song&&(!currentSong||song.id!==currentSong.id)&&_this.changeCurrentSong(song);});};_this.changeCurrentSong=function(song){var party=_this.props.party;_this.setState({currentSong:song},function(){return song&&localStorage.setItem('currentSong',JSON.stringify(song));});axios.post(\"\".concat(apiHost,\"/api/songs/current?partyId=\").concat(party.id),useFormatSong(song));};_this.getQueue=function(){axios.get(\"\".concat(apiHost,\"/api/songs/all\"),{params:{partyId:_this.props.party.id}}).then(function(response){return _this.setState({queue:response.data});});};_this.leaveParty=function(){var _this$props=_this.props,party=_this$props.party,member=_this$props.member;axios.get(\"\".concat(apiHost,\"/api/members/leave\"),{params:{memberId:member.id,partyId:party.id}}).then(function(){alert(\"You have left the party.\");_this.setState({leftParty:true});});};return _this;}_createClass(PartyContainer,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props2=this.props,party=_this$props2.party,member=_this$props2.member;if(member.id===party.host.id);setInterval(this.getCurrentSong,1000);setInterval(this.getQueue,1000);}},{key:\"render\",value:function render(){if(this.state.leftParty)return/*#__PURE__*/React.createElement(Redirect,{to:\"/\"});var _this$props3=this.props,party=_this$props3.party,member=_this$props3.member;var queue=this.state.queue;queue.currentSongIdx=party.currentSongIdx;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Mobile,{party:_objectSpread(_objectSpread({},party),{},{queue:queue}),member:member,leaveParty:this.leaveParty}));}}]);return PartyContainer;}(Component);export default PartyContainer;","map":{"version":3,"sources":["/home/mitchell/Projects/party-q/web/src/components/party/active/PartyContainer.js"],"names":["React","Component","Mobile","axios","apiHost","useFormatSong","Redirect","PartyContainer","state","currentSong","JSON","parse","localStorage","getItem","queue","getCurrentSong","party","props","host","get","headers","token","then","response","song","data","item","id","changeCurrentSong","setState","setItem","stringify","post","getQueue","params","partyId","leaveParty","member","memberId","alert","leftParty","setInterval","currentSongIdx"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Mobile from './mobile';\nimport axios from 'axios';\nimport { apiHost } from 'config';\nimport useFormatSong from 'hooks/useFormatSong';\nimport { Redirect } from 'react-router-dom';\n\nclass PartyContainer extends Component {\n\n    state = {currentSong: JSON.parse(localStorage.getItem('currentSong')), queue: []};\n\n    getCurrentSong = () => {\n\n        const { party } = this.props;\n        const { currentSong } = this.state;\n\n        if(!party || !party.host) return;\n\n        axios.get(\"https://api.spotify.com/v1/me/player/currently-playing\", {\n            headers: {\n                'Authorization': 'Bearer ' + party.host.token\n            }\n        }).then(response => {\n            const song = response.data.item;\n            song && (!currentSong || song.id !== currentSong.id) && this.changeCurrentSong(song);\n        })\n    }\n\n    changeCurrentSong = song => {\n        const { party } = this.props;\n        this.setState({currentSong: song}, () => song && localStorage.setItem('currentSong', JSON.stringify(song)));\n        axios.post(`${apiHost}/api/songs/current?partyId=${party.id}`, useFormatSong(song));\n    }\n\n    getQueue = () => {\n        axios.get(`${apiHost}/api/songs/all`, { params: {partyId : this.props.party.id} })\n            .then(response => this.setState({queue: response.data}));\n    }\n\n    leaveParty = () => {\n        const { party, member } = this.props;\n        axios.get(`${apiHost}/api/members/leave`, {\n            params: {\n                memberId: member.id,\n                partyId: party.id\n            }\n        }).then(() => {\n            alert(\"You have left the party.\");\n            this.setState({leftParty: true});\n        })\n    }\n\n    componentDidMount() {\n        const { party, member } = this.props;\n\n        if(member.id === party.host.id);\n            setInterval(this.getCurrentSong, 1000);\n\n        setInterval(this.getQueue, 1000);\n    }\n      \n    render() {\n        if(this.state.leftParty)\n            return <Redirect to=\"/\" />\n\n        const { party, member } = this.props;\n        let { queue } = this.state;\n\n        queue.currentSongIdx = party.currentSongIdx;\n\n        return(\n            <div>\n                <Mobile party={{...party, queue}} member={member} leaveParty={this.leaveParty}  />\n            </div>\n        )\n    }\n}\n \nexport default PartyContainer;"]},"metadata":{},"sourceType":"module"}